<htmlform formName="CACx Screening Form"
          formDescription="CACx Screening Form"
          formEncounterType="91725548-2d90-4b28-be6d-0509ba37bb0f"
          formUuid="e4c98c45-f01e-4737-a62a-baf981ae7b14"
          formVersion="3.0.0"
          formAddMetadata="yes"
          formUILocation="patientDashboard.visitActions"
          formOrder="16"
          formIcon="icon-medkit"
          formShowIf="(visit.active || !visit.active) &amp;&amp; patient.person.dead==false&amp;&amp; (sessionLocation.uuid=='86863db4-6101-4ecf-9a86-5e716d6504e4' || sessionLocation.uuid=='7c231e1a-1db5-11ea-978f-2e728ce88125' || sessionLocation.uuid=='e9bc61b5-69ff-414b-9cf0-0c22d6dfca2b')"
          formDisplayStyle="Standard"
          formLabel="Cervical Cancer Screening Form">

    <script type="text/javascript">
        if (jQuery) {

        jq(document).ready(function () {
            var encounterDate = new Date((getValue('encounterDate.value')));
            var patientUUID      = '<lookup complexExpression="$patient.uuid"/>';

            jq('#encounterDate').change(function(){
                encounterDate= new Date((getValue('encounterDate.value')));
            });

            function savePatientToCohort(cohortuuid){
                var cohort = cohortuuid;
                var date = encounterDate.getFullYear()+'-'+(encounterDate.getMonth()+1)+'-'+encounterDate.getDate();
                var DSDCategory = getValue('cddp_category.value');
                var dataToPost = "{\"patient\": \"" +  patientUUID + "\", \"cohort\": \"" + cohort + "\",\"startDate\": \"" + date+ "\"}";
                jq.ajax({
                    type: "POST",
                    url: '/' + OPENMRS_CONTEXT_PATH + "/ws/rest/v1/cohortm/cohortmember/",
                    dataType: "json",
                    contentType: "application/json",
                    accept: "application/json",
                    data: dataToPost,
                    success: function (data) {
                        jq().toastmessage('showSuccessToast', "Client Added to a SMS Group Successfully");
                    },
                    error: function (response) {
                        if (cohort !== ""){
                            var errorMessage = response.responseJSON.error.message;
                            if(errorMessage.indexOf("already exists") > 0){
                                jq().toastmessage('showSuccessToast', response.responseJSON.error.message);
                            }else{
                            jq().toastmessage('showErrorToast', response.responseJSON.error.message);
                            }
                        }
                    }
                    });
            }

            disable_fields("166567");

            jq("#166566").click(function () {
            if (jq(this).find("input[type='radio']:checked").val() == "90003") {
                enable_fields("166567");
            } else {
                disable_fields("166567");
            }
            });

            beforeSubmit.push(function () {
                <!-- verify that phone number is valid     -->
                var phone_number = getValue('166561.value');
                var cohortUuid="";
                if(phone_number!==""){
                    phone_number = phone_number.replace(/\(|\)|\s+|-/g, "");
                    if(!(phone_number.length == 12 &amp;&amp; phone_number.match(/^[2]{1}[5]{1}[6]{1}[0-9]{9}$/g))){
                        jq().toastmessage('showErrorToast', "Please specify a valid mobile number without any spaces like 256712345678");
                        return false;
                    }
                }else if( getValue('166566' + '.value')!== 90003){
                    jq().toastmessage('showErrorToast', "Phone number is required");
                    return false;
                }

<!--  assign cohorts to client depending on the types of reminders they have chosen  -->
                if (jq("#appointmentReminder").find(':checkbox').prop('checked')) {
<!--                    assign SMS appointment reminder cohort-->
                    cohortUuid="c418984c-fe55-431a-90be-134da0a5ec67";
                    savePatientToCohort(cohortUuid);
                }

                if (jq("#nonsuppressedReminder").find(':checkbox').prop('checked')) {
                <!--   assign SMS appointment reminder cohort-->
                    cohortUuid="f538f903-0258-4151-a4f6-f8ceb8046017";
                    savePatientToCohort(cohortUuid);
                }
                return true;
            });


        });
        }


    </script>


    <div class="ai-page-frame" id="CACx-Screening-form">

        <div class="row">
            <div class="col-md-6">
                <h1 style="padding: 10px;">CACx Screening Form</h1>
            </div>
            <div class="col-md-4"></div>
            <div class="col-md-2">
                <submit class="confirm" submitLabel="Save" submitStyle="customSubmit"/>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        Client Information
                    </div>
                    <div id="enrollment" class="card-body">
                        <div class="row">
                            <div class="col-md-3" id="visit-date">
                                <label>Date</label>
                                <encounterDate default="today"
                                               disallowMultipleEncountersOnDate="block"/>
                            </div>
                            <div class="col-md-3">
                                <label>Serial Number</label>
                                <obs conceptId="1646" id="1646"/>
                            </div>
                            <div class="col-md-3">
                                <label>Reg. No.</label>
                                <obs id="168696" conceptId="168696"/>
                            </div>
                            <div class="col-md-3">
                                <label>Referred In</label>
                                <obs id="99110" conceptId="99110" answerConceptIds="1065,1066" answerLabels="Yes, No" style="radio"/>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-3">
                                <label>Entry point Code</label>
                                <obs conceptId="164993"
                                     answerConceptIds="160542,165047,165048,165046,165348,164984,90015,168695,  90018,99456,90002" 
                                     answerLabels="OPD, ART Clinic, TB Clinic,Postnatal Clinic, Mother Baby Care Point, Family Planning Clinic,STI Clinic, Cancer Unit, In patient ward, Community/Outreach, Other Specify"
                                     id="90200"/>
                            </div>
                            <div class="col-md-3">
                                <label>Other Testing Point<label/>
                                <obs id="165398" conceptId="165398">
                            </div>
                            <div class="col-md-3">
                                <label>Entry Point Clinic No. (emr different concept for each point)</label>
                                
                            </div>
                            <div class="col-md-3">
                                <label>HIV Status</label>
                                <obs conceptId="90253" id="90253"
                                     answerConceptIds="90167,90166,90001"
                                     answerLabels="NEG- HIV-, POS- HIV+, UK- Unknown"/>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-3">
                                <label>ART Status</label>
                                <obs conceptId="1358" id="1358"
                                     answerConceptIds="1367, 165904, 1175"
                                     answerLabels="On ART, Not On ART, Not Applicable"/>
                            </div>
                            <div class="col-md-3">
                                <obs id="99431" conceptId="99431"
                                     labelText="ART Number"/>
                            </div>
                        </div>

                    </div>
                </div>
                <div id="exit" class="card">
                    <div class="card-header">
                        Eligibility Criteria
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <label>Ever been screened for cervical cancer</label>
                                <obs id="166905" conceptId="166905" answerConceptIds="1065,1066,1175" answerLabels="Yes,No,NA" style="radio"/>
                            </div>
                            <div class="col-md-4">
                                 <label>Given Pre-Test Counselling</label>
                                <obs id="162891" conceptId="162891" answerConceptIds="1065,1066,1175" answerLabels="Yes,No,NA" style="radio"/>
                            </div>
                            <div class="col-md-4">
                                <label>Are you menstruating now? Missing</label>
                                <obs id="168697" conceptId="168697" answerConceptIds="1065,1066,1175" answerLabels="Yes,No,NA" style="radio"/>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <label>Are you pregnant</label>
                                <obs id="90041" conceptId="90041" answerConceptIds="1065,1066,1175" answerLabels="Yes,No,NA" style="radio"/>
                            </div>
                            <div class="col-md-4">
                                <label>Have you been pregnant in the last 3 months</label>
                                <obs id="168698" conceptId="168698" answerConceptIds="1065,1066,1175" answerLabels="Yes,No,NA" style="radio"/>
                            </div>
                            <div class="col-md-4">
                                <label>Have you had a total hysterectomy</label>
                                <obs id="168699" conceptId="168699" answerConceptIds="1065,1066,1175" answerLabels="Yes,No,NA" style="radio"/>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <label>Have you previously been on Cervical Cancer treatment</label>
                                <obs id="168700" conceptId="168700" answerConceptIds="1065,1066,1175" answerLabels="Yes,No,NA" style="radio"/>
                            </div>
                            <div class="col-md-4">
                                <label>Eligible for Cervical Cancer Screening</label>
                                <obs id="168701" conceptId="168701" answerConceptIds="1065,1066,1175" answerLabels="Yes,No,NA" style="radio"/>
                            </div>
                            <div class="col-md-4">
                                <label>Ready to receive service Missing</label>
                                <obs id="168702" conceptId="168702" answerConceptIds="1065,1066,1175" answerLabels="Yes,No,NA" style="radio"/>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</htmlform>