<htmlform formName="Viral Load Request Form"
          formDescription=""
          formUuid="c0ba84af-d2b3-485f-bede-9c008fbc0d03"
          formEncounterType="cbf01392-ca29-11e9-a32f-2a2ae2dbcce4"
          formVersion="4.0.0"
          formAddMetadata="yes"
          formUILocation="patientDashboard.overallActions"
          formOrder="1"
          formIcon="icon-exchange"
          formShowIf="patient.person.dead==false"
          formDisplayStyle="Standard"
          formLabel="HMIS ACP 002: LAB REQUEST FORM FOR HIV VIRAL LOAD ANALYSIS">
    <style>

        form label, .form label {
            float: left;
            padding: 0px 10px 0 0;
        }

        form input[type="checkbox"], form input[type="radio"], .form input[type="checkbox"], .form input[type="radio"] {
            margin: 10px 15px;
        }

        table td {
            background: #FFFFFF;
            color: #404040;
        }

        form select, .form select {
            min-width: 0px;
        }

        form input, form select, form textarea, form ul.select, .form input, .form select, .form textarea, .form
        ul.select {
            background-color: #FBFBFB;
            border: 1px solid #CEC9C9;
            border-radius: 5px;
            margin-bottom: 10px;
            padding: 10px;
            min-width: 20%;
        }

        .row {
            display: inline-flex;
            clear: both;
        }

        .results_style {
            font-weight: bold;
            color: #0808fd;
        }

        .row .row-col2 {
            float: left;
            width: 50%;
        }

        table th, table td {
            border: 1px solid #AFAFAF;
        }

        #br {
            white-space: pre;
        }

        input[type="checkbox"] {
            margin: 0px 2px;
        }

        .obs-field {

        }

        .div-col2 {
            display: table-cell;
            margin-right: auto;
            margin-left: auto;
            width: 20%;
        }
    </style>
    <script type="text/javascript">
        if (jQuery) {
            jq(document).ready(function () {
                var patientuuid = '<lookup expression="patient.uuid"/>';
                var artInitiationDate = '<lookup expression="fn.latestObs('99161').valueDatetime"/>';
                var who_stage='<lookup expression="fn.latestObs('99070').valueCoded.name"/>';
                var treatment_line= '<lookup expression="fn.currentProgramWorkflowStatus(5).state.concept.name" />';
                var current_regimen= '<lookup expression="fn.latestObs('90315').valueCoded.name"/>';
                var pregnant = '<lookup expression="fn.latestObs('90041').valueCoded.name"/>';
                var anc = '<lookup expression="patient.getPatientIdentifier('b0cc255e-ef57-4266-839e-0df7f5099eb9')"/>';
                var pnc= '<lookup expression="patient.getPatientIdentifier('758ef6e4-9ceb-4137-bc8d-9246dc7b41fe')"/>';
                var tb_status ='<lookup expression="fn.latestObs('90216').valueCoded.name"/>';
                var tb_start_date ='<lookup expression="fn.latestObs('90217').valueDatetime"/>';
                var adherence ='<lookup expression="fn.latestObs('90221').valueCoded.name"/>';
                var dsdm = '<lookup expression="fn.latestObs('165143').valueCoded.name"/>';


                if(artInitiationDate != '') {
                    jq("#99161").find("input").attr("style", "display: none;");
                    jq("#99161").append("<span><p>"+artInitiationDate+"</p></span>");
                }

                if(who_stage != '') {

                    jq("#who-clinic-stage").find("select").attr("style", "display: none;");
                    jq("#who-clinic-stage").append("<span><p>"+who_stage+"</p></span>");
                }

                if(treatment_line != '') {
                    jq("#treatment-line").find("select").attr("style", "display: none;");
                    jq("#treatment-line").append("<span><p>"+treatment_line+"</p></span>");
                }

                if(current_regimen != '') {
                    jq("#art-regimen").find("select").attr("style", "display: none;");
                    jq("#art-regimen").append("<span><p>"+current_regimen+"</p></span>");
                }

                if(pregnant != '') {
                    jq("#pregnant").find("input").attr("style", "display: none;");
                    jq("#breast-feeding").find("input").attr("style", "display: none;");
                    jq("#not-pregnant-not-breast-feeding").find("input").attr("style", "display: none;");
                    jq("#not-pregnant-not-applicable").find("input").attr("style", "display: none;");
                    jq("#pregnancy-status").append("<span><p>"+pregnant+"</p></span>");
                }

                if(tb_status != '') {
                    jq("#tb-status").find("select").attr("style", "display: none;");
                    jq("#tb-status").append("<span><p>"+tb_status+"</p></span>");
                }

                if(adherence != '') {
                    jq("#art-adherence").find("input").attr("style", "display: none;");
                    jq("#art-adherence").append("<span><p>"+adherence+"</p></span>");
                }

                if(dsdm != '') {
                    jq("#165143").find("select").attr("style", "display: none;");
                    jq("#165143").append("<span><p>"+dsdm+"</p></span>");
                }


                console.log(patientuuid+'patient id');
                console.log(artInitiationDate+'art Initiation Date');
                console.log(who_stage+'who stage Date');
                console.log(treatment_line);
                console.log(current_regimen+'current regimen');
                console.log(pregnant+'pregnancy status');
                console.log(anc+'anc no');
                console.log(pnc+'pnc no');
                console.log(tb_start_date +'tb start date');
                console.log(tb_status +'tb status');
                console.log(adherence +'adherence');
                console.log(dsdm +'dsdm');


                });

            beforeSubmit.push(function () {
                var submitVal = true;
                var submitValStage = [];


                return submitVal;
            });
        }
    </script>
    <div class="ai-page-frame" id="request_form">
        <div class="headers" style="text-align: center;">
            <h3>HMIS ACP 002: LAB REQUEST FORM FOR HIV VIRAL LOAD ANALYSIS</h3>
        </div>
        <section>
            <table>
                <tbody>

                    <tr>
                        <td> Date:
                            <encounterDate required="true"/>
                            <span style="display: none;">
                                <encounterLocation default="629d78e9-93e5-43b0-ad8a-48313fd99117"
                                                   order="629d78e9-93e5-43b0-ad8a-48313fd99117"/>
                            </span>

                            <obs id="99161" conceptId="99161" labelText="ART Start Date:"/>
                        </td>
                        <td>
                            <div class="div-row">
                            <div class="col-md-1"></div>
                            <div class="col-md-2">
                                <label>WHO Clinical stages</label>
                            </div>
                            <div class="col-md-3">
                                <obs id="who-clinic-stage" class="long-value-select" conceptId="90203"
                                     answerConceptIds="90033,90034,90035,90036,90293,90294,90295,90296"
                                     answerLabels="1,2,3,4,T1,T2,T3,T4"/>
                            </div>
                            </div>
                        </td>
                        <td>
                            <div  id="treatment-line">
                                <workflowState  workflowId="3" labelText="Treatment line" stateIds="11,12,13" stateLabels="FIRST LINE ARV REGIMEN,SECOND LINE ARV REGIMEN,THIRD LINE ARV REGIMEN" style="dropdown" />
                            </div>
                        </td>
                        <td>
                            <div class="col-md-3">
                                <obs id="art-regimen" conceptId="90315" labelText="Regimen:"
                                     answerConceptIds="99015,99016,99005,99006,164979,99039,99040,164977,99041,99042,99007,99008,99044,99043,99282,99283,99046,99017,99018,99019,99045,99284,99285,99286,99884,99885,164978,99888,163017,99887,90002"
                                     answerLabels="d4T-3TC-NVP,d4T-3TC-EFV,AZT-3TC-NVP,AZT-3TC-EFV,AZT-3TC-DTG,TDF-3TC-NVP,TDF-3TC-EFV,TDF-3TC-DTG,TDF-FTC-NVP,TDF-FTC-EFV,ABC-ddI(250)-LPV/r,ABC-ddI(400)-LPV/r,TDF-3TC-LPV/r,TDF-FTC-LPV/r,ZDV-ddI(250)-LPV/r,ZDV-ddI(400)-LPV/r,AZT-3TC-LPV/r,ABC-ddI-LPV/r,ABC-ddI-NFV,ABC-ddI-SQV/r,ZDV-ddI-LPV/r,AZT-ABC-LPV/r,ABC-ddI-ATV/r,AZT-3TC-ATV/r,ABC-3TC-NVP,ABC-3TC-EFV,ABC-3TC-DTG,ABC-3TC-ATV/r,ABC-3TC-LPV/r,TDF-3TC-ATV/r,Other"/>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>
            <table>
            <tbody>

                <tr>
                    <td>
                        <div class="row">
                            <excludeIf velocityTest="$patient.gender =='M' || $patient.age &lt; 9">
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            <label>Pregnancy Status</label>
                                        </div>
                                        <div class="card-body">
                                            <div>
                                                <div class="row">
                                                    <div class="col-md-10">
                                                        <label>Pregnancy Status</label>
                                                        <span class="pregnancy" id="pregnancy-status">
                                                            <obs conceptId="90041" answerConceptId="1065"
                                                                 answerLabel="P - Pregnant"
                                                                 id="pregnant"/>
                                                            <obs conceptId="90041" answerConceptId="99601"
                                                                 answerLabel="BF - Breast Feeding"
                                                                 id="breast-feeding"/>
                                                            <obs conceptId="90041" answerConceptId="1066"
                                                                 answerLabel="NPB - Not pregnant or not breast feeding"
                                                                 id="not-pregnant-not-breast-feeding"/>
                                                            <obs conceptId="90041" answerConceptId="1175"
                                                                 answerLabel="NA - Not Applicable"
                                                                 id="not-pregnant-not-applicable"/>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </excludeIf>
                        </div>
                    </td>
                    <td>
                        <div class="col-md-3">
                            <label>Tb Status</label>
                            <obs id="tb-status" class="long-value-select" conceptId="90216"
                                 answerConceptIds="90079,90073, 165295, 165296, 165297, 165298, 165299,165300,90071,99421"
                                 answerLabels="1 - No signs,2 - Presumptive, 3C - TB Diagnosed - Clinically diagnosed,  3G - TB Diagnosed - Gene Xpert, 3L - TB Diagnosed - TB LAM,3M - TB Diagnosed -TB Microscopy, 3X - TB Diagnosed - Chest Xray, 3O - TB Diagnosed - Others, 4 - Tb Rx - Currently on TB treatment, 5 - Completed TB Treatment"/>
                        </div>
                    </td>
                    <td>
                        <div class="row">
                            <label>Adherence</label>
                            <div class="col-md-6">
                                <span id="art-adherence" class="ART-adherence horizontal">
                                    <obs conceptId="90221" answerConceptIds="90156,90157,90158"
                                         answerLabels="Good, Fair, Poor" style="radio"/>
                                </span>
                            </div>
                        </div>
                    </td>
                    <td>
                        <obs id="165143" conceptId="165143"
                             answerConceptIds="165138,165140,165139,165142,165141"
                             answerLabels="FBIM,FBG,FTR,CDDP,CCLAD" required="required"
                             labelText="Approach" class="horizontal long-value-select"/>
                    </td>
                </tr>
            </tbody>
        </table>
        <section>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-12">
                        <obs id="order-viral-load-test" conceptId="1271"
                             answerConceptId="165412"
                             answerLabel="Order Viral Load Test"/>
                    </div>
                </div>
                <div class="row">
                    <obsgroup groupingConceptId="165412">
                        <div class="col-md-6">
                            <label>Date collected</label>
                            <obs id="date-viral-load-taken" conceptId="163023"
                                 allowFutureDates="false"/>
                        </div>
                    </obsgroup>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <label>Specimen ID/Accession Number</label>
                        <obs id="viral-load-accession-number"
                             conceptId="165845"/>
                    </div>

                    <div class="col-md-6">
                        <label>Specimen Source</label>
                        <obs id="viral-load-specimen-source" conceptId="159959"
                             answerConceptSetIds="162476"/>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <label>Indication for viral load testing</label>
                        <obs id="indication-for-viral-load-testing" conceptId="168689" style="checkbox"/>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-4">
                    <label><span class="required">*</span>Counselor</label>
                    <encounterProvider required="true"/>
                </div>
            </div>
        </section>

    </div>
    <submit submitLabel="Save"/>


<!--    <postSubmissionAction class="org.openmrs.module.ugandaemr.htmlformentry.PatientReferralPostSubmissionAction"/>-->
</htmlform>